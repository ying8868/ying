#!/usr/bin/python3
import datetime
import time
import json
import math
import sys  
import threadpool 
import config as conf
import lib.util as u
from lib.ying_quote import *


js1 = '{"name":"海王生物","code":"000078","info":{"c":"4.05","h":"4.05","l":"3.70","o":"3.71","a":"552521552","v":"1387531","yc":"3.68","time":"2019-02-28 15:00:00","ticks":"34200|54000|1|34200|41400|46800|54000","total":"256","pricedigit":"0.00","jys":"6","Settlement":"-","mk":2,"sp":"5.36","isrzrq":false},"data":["2019-02-28 09:15,3.68,0,3.680,0","2019-02-28 09:16,3.68,0,3.680,0","2019-02-28 09:17,3.68,0,3.680,0","2019-02-28 09:18,3.68,0,3.680,0","2019-02-28 09:19,3.69,0,3.680,0","2019-02-28 09:20,3.69,0,3.680,0","2019-02-28 09:21,3.70,0,3.680,0","2019-02-28 09:22,3.70,0,3.680,0","2019-02-28 09:23,3.70,0,3.680,0","2019-02-28 09:24,3.71,0,3.680,0","2019-02-28 09:25,3.71,0,3.680,0","2019-02-28 09:26,3.71,934,3.710,0","2019-02-28 09:27,3.71,0,3.710,0","2019-02-28 09:28,3.71,0,3.710,0","2019-02-28 09:29,3.71,0,3.710,0","2019-02-28 09:30,3.71,0,3.710,0","2019-02-28 09:31,3.72,3993,3.716,0","2019-02-28 09:32,3.73,4071,3.718,0","2019-02-28 09:33,3.75,4983,3.725,0","2019-02-28 09:34,3.76,3947,3.732,0","2019-02-28 09:35,3.78,7036,3.743,0","2019-02-28 09:36,3.77,7713.5,3.750,0","2019-02-28 09:37,3.77,3987,3.752,0","2019-02-28 09:38,3.76,4072,3.753,0","2019-02-28 09:39,3.73,5098,3.752,0","2019-02-28 09:40,3.75,2030,3.751,0","2019-02-28 09:41,3.76,2805,3.751,0","2019-02-28 09:42,3.76,685,3.751,0","2019-02-28 09:43,3.75,3861,3.752,0","2019-02-28 09:44,3.77,2000,3.752,0","2019-02-28 09:45,3.79,10753.04,3.756,0","2019-02-28 09:46,3.83,13729,3.765,0","2019-02-28 09:47,3.80,7741.5,3.770,0","2019-02-28 09:48,3.80,4296.5,3.771,0","2019-02-28 09:49,3.80,3030,3.771,0","2019-02-28 09:50,3.80,2935,3.772,0","2019-02-28 09:51,3.80,2646,3.773,0","2019-02-28 09:52,3.80,2558,3.773,0","2019-02-28 09:53,3.79,4279,3.774,0","2019-02-28 09:54,3.81,4332,3.776,0","2019-02-28 09:55,3.82,3964,3.777,0","2019-02-28 09:56,3.82,7766,3.780,0","2019-02-28 09:57,3.82,2453,3.781,0","2019-02-28 09:58,3.82,3256,3.782,0","2019-02-28 09:59,3.82,4524,3.783,0","2019-02-28 10:00,3.79,4582,3.784,0","2019-02-28 10:01,3.81,1822,3.784,0","2019-02-28 10:02,3.80,3422,3.784,0","2019-02-28 10:03,3.79,1412,3.784,0","2019-02-28 10:04,3.80,2502,3.785,0","2019-02-28 10:05,3.80,1140,3.785,0","2019-02-28 10:06,3.80,2759,3.785,0","2019-02-28 10:07,3.80,1523.48,3.785,0","2019-02-28 10:08,3.81,1594,3.785,0","2019-02-28 10:09,3.80,1056,3.786,0","2019-02-28 10:10,3.82,1732.37,3.786,0","2019-02-28 10:11,3.82,3638,3.787,0","2019-02-28 10:12,3.82,1101,3.787,0","2019-02-28 10:13,3.81,1360,3.787,0","2019-02-28 10:14,3.85,21319.96,3.793,0","2019-02-28 10:15,3.85,11350,3.796,0","2019-02-28 10:16,3.85,7075,3.798,0","2019-02-28 10:17,3.86,2965,3.799,0","2019-02-28 10:18,3.87,5703.45,3.801,0","2019-02-28 10:19,3.87,4743,3.802,0","2019-02-28 10:20,3.87,13480,3.806,0","2019-02-28 10:21,3.86,8500,3.808,0","2019-02-28 10:22,3.86,1863,3.809,0","2019-02-28 10:23,3.87,6079,3.810,0","2019-02-28 10:24,3.86,6248,3.811,0","2019-02-28 10:25,3.88,4968.5,3.813,0","2019-02-28 10:26,3.87,5466.5,3.814,0","2019-02-28 10:27,3.91,18593.5,3.819,0","2019-02-28 10:28,3.95,24926,3.828,0","2019-02-28 10:29,3.96,16971,3.835,0","2019-02-28 10:30,4.05,87121.87,3.875,0","2019-02-28 10:31,4.05,33531.64,3.888,0","2019-02-28 10:32,4.05,8416,3.891,0","2019-02-28 10:33,4.05,6003,3.893,0","2019-02-28 10:34,4.05,7511,3.896,0","2019-02-28 10:35,4.05,42763.89,3.909,0","2019-02-28 10:36,4.00,25512.11,3.914,0","2019-02-28 10:37,4.03,21866,3.918,0","2019-02-28 10:38,4.03,29831.53,3.924,0","2019-02-28 10:39,4.02,14902,3.926,0","2019-02-28 10:40,4.03,14907,3.929,0","2019-02-28 10:41,4.03,10260,3.930,0","2019-02-28 10:42,4.04,15226.5,3.933,0","2019-02-28 10:43,4.04,17838,3.936,0","2019-02-28 10:44,4.04,8893,3.937,0","2019-02-28 10:45,4.03,6610,3.938,0","2019-02-28 10:46,4.03,7530.5,3.939,0","2019-02-28 10:47,4.02,10752,3.940,0","2019-02-28 10:48,4.01,8930.5,3.941,0","2019-02-28 10:49,3.99,6027,3.942,0","2019-02-28 10:50,3.96,11853,3.942,0","2019-02-28 10:51,3.98,13583,3.942,0","2019-02-28 10:52,3.97,7779.02,3.943,0","2019-02-28 10:53,3.97,3310,3.943,0","2019-02-28 10:54,3.99,7379,3.943,0","2019-02-28 10:55,3.99,3986,3.943,0","2019-02-28 10:56,3.98,5905,3.944,0","2019-02-28 10:57,3.98,2748,3.944,0","2019-02-28 10:58,3.97,3681,3.944,0","2019-02-28 10:59,3.97,7732.5,3.944,0","2019-02-28 11:00,3.97,7998,3.945,0","2019-02-28 11:01,3.98,5959,3.945,0","2019-02-28 11:02,3.98,2201,3.945,0","2019-02-28 11:03,3.98,2115,3.945,0","2019-02-28 11:04,3.98,1568.08,3.945,0","2019-02-28 11:05,3.97,1328.92,3.945,0","2019-02-28 11:06,3.98,1861.08,3.945,0","2019-02-28 11:07,3.97,3794,3.945,0","2019-02-28 11:08,3.97,1386,3.945,0","2019-02-28 11:09,3.97,3135.92,3.945,0","2019-02-28 11:10,3.97,2973,3.946,0","2019-02-28 11:11,3.95,6997.98,3.946,0","2019-02-28 11:12,3.96,6832.02,3.946,0","2019-02-28 11:13,3.97,4163,3.946,0","2019-02-28 11:14,3.98,9889.5,3.946,0","2019-02-28 11:15,3.98,1276,3.946,0","2019-02-28 11:16,3.99,3651.5,3.946,0","2019-02-28 11:17,3.99,1175,3.946,0","2019-02-28 11:18,3.98,2565,3.946,0","2019-02-28 11:19,3.96,3679.5,3.947,0","2019-02-28 11:20,3.96,2330,3.947,0","2019-02-28 11:21,3.96,6397,3.947,0","2019-02-28 11:22,3.96,1897.5,3.947,0","2019-02-28 11:23,3.97,3071,3.947,0","2019-02-28 11:24,3.97,1864,3.947,0","2019-02-28 11:25,3.97,1670,3.947,0","2019-02-28 11:26,3.97,845,3.947,0","2019-02-28 11:27,3.97,2740,3.947,0","2019-02-28 11:28,3.98,2338.25,3.947,0","2019-02-28 11:29,3.98,2839.5,3.947,0","2019-02-28 11:30,3.98,2446,3.947,0","2019-02-28 13:01,4.00,10288,3.948,0","2019-02-28 13:02,4.00,4808.5,3.948,0","2019-02-28 13:03,4.01,2491,3.948,0","2019-02-28 13:04,4.01,3924,3.948,0","2019-02-28 13:05,4.00,3293.03,3.949,0","2019-02-28 13:06,3.99,2162.5,3.949,0","2019-02-28 13:07,4.00,545,3.949,0","2019-02-28 13:08,3.99,313,3.949,0","2019-02-28 13:09,3.99,1326,3.949,0","2019-02-28 13:10,4.00,1067,3.949,0","2019-02-28 13:11,3.99,735,3.949,0","2019-02-28 13:12,4.00,2053,3.949,0","2019-02-28 13:13,4.00,1391,3.949,0","2019-02-28 13:14,3.98,1832.5,3.949,0","2019-02-28 13:15,3.99,1910,3.949,0","2019-02-28 13:16,3.99,3878.58,3.949,0","2019-02-28 13:17,3.99,1011,3.949,0","2019-02-28 13:18,4.00,1395,3.950,0","2019-02-28 13:19,4.02,7418.5,3.950,0","2019-02-28 13:20,4.02,11024.03,3.951,0","2019-02-28 13:21,4.05,32511.5,3.954,0","2019-02-28 13:22,4.04,50865.56,3.959,0","2019-02-28 13:23,4.05,19824.22,3.960,0","2019-02-28 13:24,4.05,18559,3.962,0","2019-02-28 13:25,4.05,5812,3.962,0","2019-02-28 13:26,4.04,3848,3.963,0","2019-02-28 13:27,4.05,29036.3,3.965,0","2019-02-28 13:28,4.05,1520,3.965,0","2019-02-28 13:29,4.05,2268,3.965,0","2019-02-28 13:30,4.05,14699.5,3.966,0","2019-02-28 13:31,4.04,12793,3.967,0","2019-02-28 13:32,4.05,6648,3.968,0","2019-02-28 13:33,4.05,8225.75,3.968,0","2019-02-28 13:34,4.04,2048,3.968,0","2019-02-28 13:35,4.05,23479.46,3.970,0","2019-02-28 13:36,4.04,8054,3.970,0","2019-02-28 13:37,4.05,10689.65,3.971,0","2019-02-28 13:38,4.05,8736,3.972,0","2019-02-28 13:39,4.05,18369.35,3.973,0","2019-02-28 13:40,4.04,7108.5,3.973,0","2019-02-28 13:41,4.05,3446.15,3.974,0","2019-02-28 13:42,4.05,4369,3.974,0","2019-02-28 13:43,4.05,4906,3.974,0","2019-02-28 13:44,4.05,3605,3.974,0","2019-02-28 13:45,4.05,5169.85,3.975,0","2019-02-28 13:46,4.05,7695.15,3.975,0","2019-02-28 13:47,4.04,4075,3.975,0","2019-02-28 13:48,4.05,1626,3.975,0","2019-02-28 13:49,4.04,4824,3.976,0","2019-02-28 13:50,4.05,17953.03,3.977,0","2019-02-28 13:51,4.05,5251.97,3.977,0","2019-02-28 13:52,4.05,4504,3.977,0","2019-02-28 13:53,4.05,5251,3.978,0","2019-02-28 13:54,4.05,5875,3.978,0","2019-02-28 13:55,4.05,3531,3.978,0","2019-02-28 13:56,4.05,6189,3.978,0","2019-02-28 13:57,4.05,3693.24,3.979,0","2019-02-28 13:58,4.05,4637,3.979,0","2019-02-28 13:59,4.05,4928.5,3.979,0","2019-02-28 14:00,4.05,3176,3.979,0","2019-02-28 14:01,4.05,4053,3.980,0","2019-02-28 14:02,4.05,4615,3.980,0","2019-02-28 14:03,4.05,5803.5,3.980,0","2019-02-28 14:04,4.05,4633.5,3.980,0","2019-02-28 14:05,4.05,2489.6,3.980,0","2019-02-28 14:06,4.05,3087,3.981,0","2019-02-28 14:07,4.05,465,3.981,0","2019-02-28 14:08,4.05,139.5,3.981,0","2019-02-28 14:09,4.05,1346,3.981,0","2019-02-28 14:10,4.05,509,3.981,0","2019-02-28 14:11,4.05,405,3.981,0","2019-02-28 14:12,4.05,209.5,3.981,0","2019-02-28 14:13,4.05,80,3.981,0","2019-02-28 14:14,4.05,18,3.981,0","2019-02-28 14:15,4.05,326,3.981,0","2019-02-28 14:16,4.05,345,3.981,0","2019-02-28 14:17,4.05,319,3.981,0","2019-02-28 14:18,4.05,1183,3.981,0","2019-02-28 14:19,4.05,411.5,3.981,0","2019-02-28 14:20,4.05,600,3.981,0","2019-02-28 14:21,4.05,423.58,3.981,0","2019-02-28 14:22,4.05,474,3.981,0","2019-02-28 14:23,4.05,425,3.981,0","2019-02-28 14:24,4.05,2033.5,3.981,0","2019-02-28 14:25,4.05,1534.5,3.981,0","2019-02-28 14:26,4.05,646.5,3.981,0","2019-02-28 14:27,4.05,996,3.981,0","2019-02-28 14:28,4.05,1066,3.981,0","2019-02-28 14:29,4.05,459,3.981,0","2019-02-28 14:30,4.05,847,3.981,0","2019-02-28 14:31,4.05,483,3.981,0","2019-02-28 14:32,4.05,967,3.981,0","2019-02-28 14:33,4.05,312,3.981,0","2019-02-28 14:34,4.05,567,3.982,0","2019-02-28 14:35,4.05,59,3.982,0","2019-02-28 14:36,4.05,292,3.982,0","2019-02-28 14:37,4.05,690,3.982,0","2019-02-28 14:38,4.05,835,3.982,0","2019-02-28 14:39,4.05,1364,3.982,0","2019-02-28 14:40,4.05,255,3.982,0","2019-02-28 14:41,4.05,142,3.982,0","2019-02-28 14:42,4.05,60,3.982,0","2019-02-28 14:43,4.05,409,3.982,0","2019-02-28 14:44,4.05,94,3.982,0","2019-02-28 14:45,4.05,2847,3.982,0","2019-02-28 14:46,4.05,418,3.982,0","2019-02-28 14:47,4.05,439,3.982,0","2019-02-28 14:48,4.05,489.09,3.982,0","2019-02-28 14:49,4.05,507.5,3.982,0","2019-02-28 14:50,4.05,257,3.982,0","2019-02-28 14:51,4.05,382,3.982,0","2019-02-28 14:52,4.05,133,3.982,0","2019-02-28 14:53,4.05,349,3.982,0","2019-02-28 14:54,4.05,178,3.982,0","2019-02-28 14:55,4.05,129,3.982,0","2019-02-28 14:56,4.05,305,3.982,0","2019-02-28 14:57,4.05,185,3.982,0","2019-02-28 14:58,4.05,110,3.982,0","2019-02-28 14:59,4.05,0,3.982,0","2019-02-28 15:00,4.05,910,3.982,0"]}'
js2 = '{"name":"千山药机","code":"300216","info":{"c":"4.37","h":"4.37","l":"3.88","o":"3.90","a":"232915257","v":"554483","yc":"3.97","time":"2019-02-28 15:00:00","ticks":"34200|54000|1|34200|41400|46800|54000","total":"256","pricedigit":"0.00","jys":"80","Settlement":"-","mk":2,"sp":"29.30","isrzrq":false},"data":["2019-02-28 09:15,3.97,0,3.970,0","2019-02-28 09:16,3.93,0,3.970,0","2019-02-28 09:17,3.91,0,3.970,0","2019-02-28 09:18,3.91,0,3.970,0","2019-02-28 09:19,3.90,0,3.970,0","2019-02-28 09:20,3.90,0,3.970,0","2019-02-28 09:21,3.90,0,3.970,0","2019-02-28 09:22,3.90,0,3.970,0","2019-02-28 09:23,3.90,0,3.970,0","2019-02-28 09:24,3.90,0,3.970,0","2019-02-28 09:25,3.89,0,3.970,0","2019-02-28 09:26,3.90,9863,3.900,0","2019-02-28 09:27,3.90,0,3.900,0","2019-02-28 09:28,3.90,0,3.900,0","2019-02-28 09:29,3.90,0,3.900,0","2019-02-28 09:30,3.90,0,3.900,0","2019-02-28 09:31,3.93,11432,3.899,0","2019-02-28 09:32,3.93,2269,3.902,0","2019-02-28 09:33,3.94,2231,3.906,0","2019-02-28 09:34,3.97,2903,3.911,0","2019-02-28 09:35,3.99,2685,3.917,0","2019-02-28 09:36,3.99,3705,3.926,0","2019-02-28 09:37,3.99,3380,3.932,0","2019-02-28 09:38,3.97,2179.02,3.934,0","2019-02-28 09:39,3.95,822.98,3.935,0","2019-02-28 09:40,3.94,1967,3.935,0","2019-02-28 09:41,3.94,2219,3.935,0","2019-02-28 09:42,3.95,1271,3.935,0","2019-02-28 09:43,3.95,2053,3.936,0","2019-02-28 09:44,3.97,517,3.936,0","2019-02-28 09:45,3.97,581,3.936,0","2019-02-28 09:46,3.97,1512,3.937,0","2019-02-28 09:47,3.95,2026,3.938,0","2019-02-28 09:48,3.94,2350,3.938,0","2019-02-28 09:49,3.95,1001,3.938,0","2019-02-28 09:50,3.94,2620,3.938,0","2019-02-28 09:51,3.96,1822,3.938,0","2019-02-28 09:52,3.95,1189,3.939,0","2019-02-28 09:53,3.97,1202,3.939,0","2019-02-28 09:54,4.00,3537,3.942,0","2019-02-28 09:55,4.09,10945.02,3.957,0","2019-02-28 09:56,4.07,12197,3.973,0","2019-02-28 09:57,4.13,21384,3.998,0","2019-02-28 09:58,4.20,33692.93,4.034,0","2019-02-28 09:59,4.19,18570,4.054,0","2019-02-28 10:00,4.16,8149,4.059,0","2019-02-28 10:01,4.18,11680,4.065,0","2019-02-28 10:02,4.14,5318,4.068,0","2019-02-28 10:03,4.13,6585,4.070,0","2019-02-28 10:04,4.12,2956,4.071,0","2019-02-28 10:05,4.12,6660,4.072,0","2019-02-28 10:06,4.14,3589,4.073,0","2019-02-28 10:07,4.13,3900,4.074,0","2019-02-28 10:08,4.13,3276,4.075,0","2019-02-28 10:09,4.12,1504,4.076,0","2019-02-28 10:10,4.12,2565,4.076,0","2019-02-28 10:11,4.13,3130,4.077,0","2019-02-28 10:12,4.14,2232,4.078,0","2019-02-28 10:13,4.14,1881,4.078,0","2019-02-28 10:14,4.13,1449,4.078,0","2019-02-28 10:15,4.14,1263,4.079,0","2019-02-28 10:16,4.15,3623,4.080,0","2019-02-28 10:17,4.14,1769,4.080,0","2019-02-28 10:18,4.14,1461,4.081,0","2019-02-28 10:19,4.15,1125,4.081,0","2019-02-28 10:20,4.14,1397,4.081,0","2019-02-28 10:21,4.14,1906,4.082,0","2019-02-28 10:22,4.13,2049.2,4.082,0","2019-02-28 10:23,4.14,989,4.082,0","2019-02-28 10:24,4.14,1426,4.083,0","2019-02-28 10:25,4.13,1496,4.083,0","2019-02-28 10:26,4.12,2590.8,4.084,0","2019-02-28 10:27,4.13,1635,4.084,0","2019-02-28 10:28,4.13,2544,4.084,0","2019-02-28 10:29,4.12,1515,4.084,0","2019-02-28 10:30,4.12,2074,4.085,0","2019-02-28 10:31,4.13,1595,4.085,0","2019-02-28 10:32,4.14,1999,4.085,0","2019-02-28 10:33,4.18,9984,4.088,0","2019-02-28 10:34,4.16,4057,4.090,0","2019-02-28 10:35,4.15,2880,4.090,0","2019-02-28 10:36,4.15,2287,4.091,0","2019-02-28 10:37,4.14,1092,4.091,0","2019-02-28 10:38,4.14,1337,4.091,0","2019-02-28 10:39,4.14,1317,4.091,0","2019-02-28 10:40,4.14,676,4.092,0","2019-02-28 10:41,4.13,439,4.092,0","2019-02-28 10:42,4.14,615,4.092,0","2019-02-28 10:43,4.15,1433,4.092,0","2019-02-28 10:44,4.15,1486,4.092,0","2019-02-28 10:45,4.17,3217,4.093,0","2019-02-28 10:46,4.16,2486,4.094,0","2019-02-28 10:47,4.17,1445,4.094,0","2019-02-28 10:48,4.19,2865,4.095,0","2019-02-28 10:49,4.18,3329,4.096,0","2019-02-28 10:50,4.17,1021,4.096,0","2019-02-28 10:51,4.17,2710,4.097,0","2019-02-28 10:52,4.22,12566,4.101,0","2019-02-28 10:53,4.24,13695.6,4.107,0","2019-02-28 10:54,4.24,10195,4.111,0","2019-02-28 10:55,4.22,3256,4.112,0","2019-02-28 10:56,4.23,5278,4.114,0","2019-02-28 10:57,4.25,6603,4.116,0","2019-02-28 10:58,4.30,21150,4.124,0","2019-02-28 10:59,4.37,40287,4.146,0","2019-02-28 11:00,4.37,45497.54,4.168,0","2019-02-28 11:01,4.37,17937,4.175,0","2019-02-28 11:02,4.37,15568.06,4.181,0","2019-02-28 11:03,4.37,2576,4.182,0","2019-02-28 11:04,4.37,933,4.183,0","2019-02-28 11:05,4.37,1268,4.183,0","2019-02-28 11:06,4.37,582,4.183,0","2019-02-28 11:07,4.37,1938,4.184,0","2019-02-28 11:08,4.37,610,4.184,0","2019-02-28 11:09,4.37,163,4.184,0","2019-02-28 11:10,4.37,1088,4.185,0","2019-02-28 11:11,4.37,912.66,4.185,0","2019-02-28 11:12,4.37,1540,4.186,0","2019-02-28 11:13,4.37,1056,4.186,0","2019-02-28 11:14,4.37,197,4.186,0","2019-02-28 11:15,4.37,871,4.187,0","2019-02-28 11:16,4.37,234,4.187,0","2019-02-28 11:17,4.37,67,4.187,0","2019-02-28 11:18,4.37,185,4.187,0","2019-02-28 11:19,4.37,1302,4.187,0","2019-02-28 11:20,4.37,135,4.187,0","2019-02-28 11:21,4.37,492,4.187,0","2019-02-28 11:22,4.37,484,4.188,0","2019-02-28 11:23,4.37,523,4.188,0","2019-02-28 11:24,4.37,244,4.188,0","2019-02-28 11:25,4.37,202,4.188,0","2019-02-28 11:26,4.37,145,4.188,0","2019-02-28 11:27,4.37,651,4.188,0","2019-02-28 11:28,4.37,299,4.188,0","2019-02-28 11:29,4.37,151,4.188,0","2019-02-28 11:30,4.37,246,4.188,0","2019-02-28 13:01,4.37,2665,4.189,0","2019-02-28 13:02,4.37,139,4.189,0","2019-02-28 13:03,4.37,142,4.189,0","2019-02-28 13:04,4.37,67,4.189,0","2019-02-28 13:05,4.37,31,4.190,0","2019-02-28 13:06,4.37,102,4.190,0","2019-02-28 13:07,4.37,52,4.190,0","2019-02-28 13:08,4.37,349,4.190,0","2019-02-28 13:09,4.37,31,4.190,0","2019-02-28 13:10,4.37,27,4.190,0","2019-02-28 13:11,4.37,11,4.190,0","2019-02-28 13:12,4.37,65,4.190,0","2019-02-28 13:13,4.37,122,4.190,0","2019-02-28 13:14,4.37,19,4.190,0","2019-02-28 13:15,4.37,272,4.190,0","2019-02-28 13:16,4.37,21,4.190,0","2019-02-28 13:17,4.37,93,4.190,0","2019-02-28 13:18,4.37,11,4.190,0","2019-02-28 13:19,4.37,33,4.190,0","2019-02-28 13:20,4.37,78,4.190,0","2019-02-28 13:21,4.37,513,4.190,0","2019-02-28 13:22,4.37,511,4.190,0","2019-02-28 13:23,4.37,178,4.190,0","2019-02-28 13:24,4.37,84,4.190,0","2019-02-28 13:25,4.37,40,4.190,0","2019-02-28 13:26,4.37,1829,4.191,0","2019-02-28 13:27,4.37,31,4.191,0","2019-02-28 13:28,4.37,38,4.191,0","2019-02-28 13:29,4.37,668,4.191,0","2019-02-28 13:30,4.37,6,4.191,0","2019-02-28 13:31,4.37,52,4.191,0","2019-02-28 13:32,4.37,211,4.191,0","2019-02-28 13:33,4.37,161,4.191,0","2019-02-28 13:34,4.37,287,4.192,0","2019-02-28 13:35,4.37,187,4.192,0","2019-02-28 13:36,4.37,164,4.192,0","2019-02-28 13:37,4.37,108,4.192,0","2019-02-28 13:38,4.37,27,4.192,0","2019-02-28 13:39,4.37,140,4.192,0","2019-02-28 13:40,4.37,90,4.192,0","2019-02-28 13:41,4.37,64,4.192,0","2019-02-28 13:42,4.37,10,4.192,0","2019-02-28 13:43,4.37,10,4.192,0","2019-02-28 13:44,4.37,106,4.192,0","2019-02-28 13:45,4.37,88,4.192,0","2019-02-28 13:46,4.37,151,4.192,0","2019-02-28 13:47,4.37,109,4.192,0","2019-02-28 13:48,4.37,347,4.192,0","2019-02-28 13:49,4.37,212,4.192,0","2019-02-28 13:50,4.37,90,4.192,0","2019-02-28 13:51,4.37,155,4.192,0","2019-02-28 13:52,4.37,146,4.192,0","2019-02-28 13:53,4.37,107,4.192,0","2019-02-28 13:54,4.37,327,4.192,0","2019-02-28 13:55,4.37,105,4.192,0","2019-02-28 13:56,4.37,192,4.193,0","2019-02-28 13:57,4.37,41,4.193,0","2019-02-28 13:58,4.37,25,4.193,0","2019-02-28 13:59,4.37,15,4.193,0","2019-02-28 14:00,4.37,27,4.193,0","2019-02-28 14:01,4.37,418,4.193,0","2019-02-28 14:02,4.37,241,4.193,0","2019-02-28 14:03,4.37,176,4.193,0","2019-02-28 14:04,4.37,107.2,4.193,0","2019-02-28 14:05,4.37,145,4.193,0","2019-02-28 14:06,4.37,127,4.193,0","2019-02-28 14:07,4.37,30,4.193,0","2019-02-28 14:08,4.37,10,4.193,0","2019-02-28 14:09,4.37,27,4.193,0","2019-02-28 14:10,4.37,0,4.193,0","2019-02-28 14:11,4.37,222,4.193,0","2019-02-28 14:12,4.37,75,4.193,0","2019-02-28 14:13,4.37,95,4.193,0","2019-02-28 14:14,4.37,154,4.193,0","2019-02-28 14:15,4.37,91,4.193,0","2019-02-28 14:16,4.37,21,4.193,0","2019-02-28 14:17,4.37,125,4.193,0","2019-02-28 14:18,4.37,97,4.193,0","2019-02-28 14:19,4.37,59,4.193,0","2019-02-28 14:20,4.37,85,4.193,0","2019-02-28 14:21,4.37,59,4.193,0","2019-02-28 14:22,4.37,147,4.193,0","2019-02-28 14:23,4.37,99,4.193,0","2019-02-28 14:24,4.37,187,4.193,0","2019-02-28 14:25,4.37,111,4.194,0","2019-02-28 14:26,4.37,321,4.194,0","2019-02-28 14:27,4.37,3880,4.195,0","2019-02-28 14:28,4.37,705,4.195,0","2019-02-28 14:29,4.37,2460,4.196,0","2019-02-28 14:30,4.37,3770,4.197,0","2019-02-28 14:31,4.37,2944,4.198,0","2019-02-28 14:32,4.37,758,4.198,0","2019-02-28 14:33,4.37,119,4.198,0","2019-02-28 14:34,4.37,112,4.198,0","2019-02-28 14:35,4.37,502,4.199,0","2019-02-28 14:36,4.37,134,4.199,0","2019-02-28 14:37,4.37,75,4.199,0","2019-02-28 14:38,4.37,57,4.199,0","2019-02-28 14:39,4.37,186,4.199,0","2019-02-28 14:40,4.37,216,4.199,0","2019-02-28 14:41,4.37,294,4.199,0","2019-02-28 14:42,4.37,136,4.199,0","2019-02-28 14:43,4.37,85,4.199,0","2019-02-28 14:44,4.37,58,4.199,0","2019-02-28 14:45,4.37,55,4.199,0","2019-02-28 14:46,4.37,308,4.199,0","2019-02-28 14:47,4.37,99,4.199,0","2019-02-28 14:48,4.37,576,4.199,0","2019-02-28 14:49,4.37,100,4.199,0","2019-02-28 14:50,4.37,76,4.199,0","2019-02-28 14:51,4.37,327,4.199,0","2019-02-28 14:52,4.37,81,4.199,0","2019-02-28 14:53,4.37,413,4.200,0","2019-02-28 14:54,4.37,381,4.200,0","2019-02-28 14:55,4.37,499,4.200,0","2019-02-28 14:56,4.37,1274,4.200,0","2019-02-28 14:57,4.37,489,4.200,0","2019-02-28 14:58,4.37,0,4.200,0","2019-02-28 14:59,4.37,0,4.200,0","2019-02-28 15:00,4.37,842,4.201,0"]}'


class jdjx(object):
    def jaodu(self, minlist):
        df1 = minlist[1]
        #print('    code:%s  zf:%s   yc: %s   '%(minlist[0],minlist[2],minlist[3]))
        if len(df1) < 5:
            return None
        nl = []
        for y in range(10, len(df1)):
            # s=al[i].split(',')
            nl.append(df1[y].split(','))
        #print (df)
        ntime = 0
        ntimejd = 0
        jd = 0
        df = pd.DataFrame(nl, columns=['time', 'pic', 'vol', 'ma', 'w'])
        df = df.apply(pd.to_numeric, errors='ignore')

        for i in range(14, len(df)):
            df.loc[df.index[i], 'm5'] = df['ma'][i-5:i+1].mean()
            jd = math.atan((df.loc[df.index[1], 'm5'] /
                            df.loc[df.index[5], 'ma']-1)*100)*57.32
            #df.loc[df.index[i], 'm5_1'] = jd
            p1 = df.loc[df.index[i - 4], 'ma']
            p2 = df.loc[df.index[i - 3], 'ma']
            p3 = df.loc[df.index[i - 2], 'ma']
            p4=df.loc[df.index[i-1], 'ma']
            p5=df.loc[df.index[i], 'ma']
            if (p5>p1):
                ntime = df.loc[df.index[i], 'time']
                print('  将 %s 均线 连涨 角度信息更新到数据库   %s  %s  %s  '%(minlist[0],minlist[2],minlist[3],jd))
                gq.update_ONE_jaodu(minlist[0],ntime,minlist[3],jd,minlist[2])
                return
              
            '''
            elif (jd > 30 ):
                 
                ntime = df.loc[df.index[i], 'time']
                ntimejd = jd
                df.loc[df.index[-1], 'm5'] = df['ma'][-5:-1].mean()
                
                newjd = math.atan((df.loc[df.index[-1], 'm5'] /
                            df.loc[df.index[-5], 'ma']-1)*100)*57.32 
                             
                #print('%s  %s  %s  %s'%(minlist[0],ntime,ntimejd,newjd))
                print('将均线角度信息更新到数据库 %s  %s  %s  %s'%(minlist[0],ntime,ntimejd,30))
                gq.update_ONE_jaodu(minlist[0],ntime,ntimejd,30,minlist[2])
                return
                #print("m = %s, n = %s, o = %s" % (ntime, ntimejd, jd))
                '''
            


        if ntime == 0:
            return None

        #print ("m = %s, n = %s, o = %s"%(m, n, o))
        #print('将均线角度信息更新到数据库 %s  %s  %s  %s'%(minlist[0],ntime,ntimejd,jd)) 

        #gq.update_ONE_jaodu(minlist[0],ntime,ntimejd,jd)
        
        # print(df.iloc[10:20,])


gq = get_quote(conf)
 
def jaodu_core( ):
    '''  
    index=gq.get_JK_quote()
    jkdf = pd.DataFrame(list(index))
    print(jkdf) 
    '''
    minlist = gq.get_all_min_quote()
    df = pd.DataFrame(list(minlist))
    data_list = df['data'].tolist()
    # data_list=df['name'].tolist()
    code_list = df['code'].tolist()
    #

    info=pd.DataFrame(list(df['info']))
    info=info.apply(pd.to_numeric, errors='ignore')#,inplace=True
    info['nzdf']=(info['c']-info['yc'])/info['yc']*100
    yc_list =info['yc'].tolist()
    nzdf_list=info['nzdf'].tolist()
    #print(code_list)


    il = []
    for i in range(len(code_list)):
        ll = []
        ll.append(code_list[i])
        ll.append(data_list[i]) 
        ll.append(nzdf_list[i])
        ll.append(yc_list[i])
        il.append(ll) 

    jdj = jdjx()
    pool = threadpool.ThreadPool(20)
    #requests = threadpool.makeRequests(__jdfz__, il)
    requests = threadpool.makeRequests(jdj.jaodu, il)
    [pool.putRequest(req) for req in requests]
    pool.wait()

    '''
    for i in range(0,len(df)):
        al=df.iloc[i,2]
        
         
        
        l=jaodu(nldf)
         
        
    '''


def main(argv):
    '''
    角度计算程序每天早上9:35开启。
    角度计算守护程序 采用多线程的方式进行计算
    ''' 
    while True:  
       #min_df_find=gq.get_all_min_quote()
        print(gq.get_min_quote_count())
        if  gq.get_min_quote_count()==0: 
            # 判断数据表是否为空 如果为空 则不进行操作
            s=3
            print("角度计算:分时行情 数据库不存在数据 %s 秒钟以后 继续查询 当前时间 %s" %(s,datetime.datetime.now()))
            time.sleep(s) 
        else:

            d_time = datetime.datetime.strptime(str(datetime.datetime.now().date())+'9:30', '%Y-%m-%d%H:%M')
            d_time1 =  datetime.datetime.strptime(str(datetime.datetime.now().date())+'23:00', '%Y-%m-%d%H:%M')
            n_time = datetime.datetime.now()
            if n_time>d_time and n_time<d_time1:
            #if  True:
                print("开始角度计算   当前时间 %s" %(datetime.datetime.now()))
                starttime = datetime.datetime.now()
                jaodu_core()
                endtime = datetime.datetime.now()
                send=endtime-starttime 
                s=10-(send.seconds)
                print("角度计算 %s 秒钟以后 继续计算 当前时间 %s" %(s,datetime.datetime.now()))
                if s>0:
                    time.sleep(0)  
            else:

                print('角度计算:等待。。。。')
                time.sleep(30)
            #return
 

def test():
    gq_df=gq.get_min_quote('600460')

    print(gq_df['data'][15]) 

    jdj = jdjx()
    jdj.jaodu(['600460',gq_df['data'],'10.0','12.78'])
if __name__ == '__main__': 
    #test()
    main(sys.argv)